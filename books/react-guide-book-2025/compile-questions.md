---
title: "compile questions"
emoji: "📘"
type: "tech"
topics: ["react", "javascript", "frontend"]
published: false
---

# コンパイルへの疑問

## なぜ`JSX→JS→HTML`という流れなのか?
JSX→babel→js→HTML→描写は非効率だから、<br>
JSX→コンパイル→HTMLにすれば効率的ではないかと考える人もいます。

## 前提
この流れには、Reactの根本的な設計思想が関係しています。

Reactは、動的なユーザーインターフェース（UI）を効率的に構築するために作られました。
  - 動的なUI: ユーザーの操作やデータの変化に応じて、画面の一部がリアルタイムで書き換わるようなウェブサイトのこと
  - DOM操作: HTMLを直接書き換える（DOMを操作する）のは、手間がかかり、パフォーマンスの問題を引き起こしやすい作業

## `React.createElement`という手段
これを解決するために`React.createElement`は生まれた
`React.createElement`に変換し、JavaScriptのオブジェクトとして画面の「設計図」を作成することで、Reactは仮想DOM（Virtual DOM）という仕組みを使って、必要な部分だけを効率的に書き換えることができます。

## JSX→HTMLという直接的な変換の欠点
もしJSXを直接HTMLに変換した場合、動的なUIの構築が難しくなります。
- HTMLはマークアップ言語のためw静的ウェブサイトにしか適していない
  - プログラムは「状況に応じて内容を変える」機能がある
- JSXを直接HTMLに変換しようとする問題が起こる
  - データの変更に弱い : 破面更新にはHTML全体を再生成する必要がありサイトのくしていまう
  - ユーザーの操作に対応できない : ユーザーが操作しても、それに応じて画面の一部を書き換えるといった複雑な処理が直接できない
    - だからJSのようなプログラミング言語の力が必要となる

したがって、JSXは一度JavaScriptに変換され、そのJavaScriptの力を借りてUIを動的に操作する仕組みになっている。

## 補足:なぜ`React.createElement`だとSPAが可能なのか
React.createElement関数が作成するJavaScriptのオブジェクトは、ブラウザのHTML要素（DOM）を直接操作するのではなく、仮想DOM（Virtual DOM）というメモリ上にある軽い表現として存在します。

Reactは、DOM操作のコストを最小限に抑えるために、以下の2つの段階を踏みます。
1. OMの作成: React.createElementは、**仮想DOM（Virtual DOM）**というJavaScriptの軽量なオブジェクトを作成します。これは、実際のDOMのコピーのようなものです。画面に変更が発生するたびに、Reactはこの仮想DOMを新しく作り直します。
2. 差分検知と最小限の更新: 新しい仮想DOMが作成されると、Reactは前回の仮想DOMと新しい仮想DOMを比較し、どの部分が変わったかを特定します。このプロセスのことを「差分検知（diffing）」と呼びます。

この差分検知により、Reactは「たった1つのテキストが変わっただけ」といった最小限の変更点だけを把握します。

そして、最後に、Reactは特定された変更点だけをまとめて、実際のDOMに反映させます。これにより、DOM全体を書き換えるという高コストな作業を避け、必要な部分だけを効率的に更新できるため、高いパフォーマンスを維持できるのです。